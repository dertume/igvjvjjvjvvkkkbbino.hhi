
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>conwes</title>
    
    <!-- CSS Framework -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- React & Supabase Dependencies (CDN) -->
    <script src="https://unpkg.com/react@18/umd/react.production.min.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js" crossorigin></script>
    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
    
    <!-- Babel for in-browser JSX/TS compilation -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <style>
        :root {
            --bg-primary: #050505;
            --glass-base: rgba(255, 255, 255, 0.03);
            --glass-border: rgba(255, 255, 255, 0.06);
            --text-main: #e4e4e7;
            --text-muted: #a1a1aa;
        }
        
        body {
            font-family: 'Inter', sans-serif;
            background: var(--bg-primary);
            color: var(--text-main);
            -webkit-tap-highlight-color: transparent;
            overflow-x: hidden;
            margin: 0;
            line-height: 1.6;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;

            /* Disable selection and context menus globally */
            -webkit-user-select: none;
            -ms-user-select: none;
            user-select: none;
            -webkit-touch-callout: none;
        }

        /* Prevent image dragging */
        img {
            -webkit-user-drag: none;
            user-drag: none;
            pointer-events: none;
        }

        /* Re-enable selection for interactive elements */
        input, textarea {
            -webkit-user-select: text;
            user-select: text;
            background: transparent;
            border: none;
            outline: none;
            color: var(--text-main);
        }

        .heading-font { 
            font-family: 'Inter', sans-serif;
            letter-spacing: -0.02em;
        }
        
        /* Base Glass Style */
        .glass {
            background: var(--glass-base);
            backdrop-filter: blur(24px);
            -webkit-backdrop-filter: blur(24px);
            border: 1px solid var(--glass-border);
            box-shadow: 0 4px 24px -1px rgba(0, 0, 0, 0.2);
            position: relative;
            overflow: hidden;
        }

        /* StrivNet Liquid Shine Effect */
        .glass::before, .interactive-glass::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.03), transparent);
            transition: left 0.6s ease;
            pointer-events: none;
            z-index: 10;
        }

        .glass:hover::before, .interactive-glass:hover::before {
            left: 100%;
        }

        /* Darker glass for modals/overlays */
        .glass-dark {
            background: rgba(10, 10, 10, 0.9);
            backdrop-filter: blur(40px);
            -webkit-backdrop-filter: blur(40px);
            border: 1px solid rgba(255, 255, 255, 0.08);
            box-shadow: 0 20px 50px rgba(0,0,0,0.5);
        }

        /* Interactive Elements (Hover Physics) */
        .interactive-glass {
            background: var(--glass-base);
            border: 1px solid var(--glass-border);
            transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
            position: relative;
            overflow: hidden;
        }

        @media (hover: hover) {
            .interactive-glass:hover {
                transform: translateY(-4px);
                background: rgba(255, 255, 255, 0.06);
                border-color: rgba(255, 255, 255, 0.15);
                box-shadow: 0 12px 32px rgba(0, 0, 0, 0.3);
            }
        }

        .interactive-glass:active {
            transform: scale(0.99);
        }

        .safe-area-bottom {
            padding-bottom: 180px; 
        }

        .parallax-bg {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            overflow: hidden;
            pointer-events: none;
        }
        
        .floating-shape {
            position: absolute;
            border-radius: 50%;
            filter: blur(120px);
            opacity: 0.12;
            will-change: transform;
        }

        input::placeholder, textarea::placeholder {
            color: rgba(255, 255, 255, 0.2);
        }

        .img-cover {
            width: 100%;
            height: 100%;
            object-fit: cover;
            display: block;
            pointer-events: none;
        }

        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: rgba(255,255,255,0.1); border-radius: 10px; }
        ::-webkit-scrollbar-thumb:hover { background: rgba(255,255,255,0.2); }
    </style>
<link rel="stylesheet" href="/index.css">
</head>
<body>
    <div id="root"></div>

    <script type="text/babel" data-presets="typescript,react">
        /*******************************************************
         * GLOBAL SETUP
         *******************************************************/
        const { useState, useEffect, useCallback, useMemo, useRef } = React;
        
        // --- SUPABASE CLIENT ---
        const supabaseUrl = 'https://cgfqkbwvmukhelntnyic.supabase.co';
        const supabaseKey = 'sb_publishable_AiwaSOqrGSSVGBhqPsjdgg_ha7LdxX7'; 
        // FIX: Rename to supabaseClient to avoid collision with global 'supabase' variable from CDN
        const supabaseClient = window.supabase.createClient(supabaseUrl, supabaseKey);

        /*******************************************************
         * TYPES & ENUMS
         *******************************************************/
        // Types in TS via Babel are stripped at runtime, but Enums need value
        const View = {
          HOME: 'home',
          PLAYLISTS: 'playlists',
          PROFILE: 'profile',
          SETTINGS: 'settings'
        };

        /*******************************************************
         * COMPONENTS
         *******************************************************/

        // --- Logo.tsx ---
        const Logo = ({ className = "w-8 h-8" }) => (
          <svg viewBox="0 0 36 36" fill="none" xmlns="http://www.w3.org/2000/svg" className={className}>
            <path d="M6 12V24" stroke="currentColor" strokeWidth="4" strokeLinecap="round" />
            <path d="M14 6V30" stroke="currentColor" strokeWidth="4" strokeLinecap="round" />
            <path d="M22 6V30" stroke="currentColor" strokeWidth="4" strokeLinecap="round" />
            <path d="M30 8V12" stroke="currentColor" strokeWidth="4" strokeLinecap="round" />
            <path d="M30 24V28" stroke="currentColor" strokeWidth="4" strokeLinecap="round" />
          </svg>
        );

        // --- TrackItem.tsx ---
        const TrackItem = ({ 
          track, onPlay, isPlaying, isActive, onDelete, isFollowing, onToggleFollow, isOwner, rank, isPending
        }) => {
          return (
            <div 
              onClick={() => onPlay(track)}
              className={`
                interactive-glass group relative flex items-center justify-between p-3 rounded-2xl cursor-pointer
                ${isActive ? 'bg-white/10 border-white/10' : ''}
              `}
            >
              <div className="flex items-center gap-4 flex-1 min-w-0 relative z-10">
                <div className="relative w-14 h-14 aspect-square rounded-xl overflow-hidden bg-zinc-900 flex-shrink-0 shadow-lg ring-1 ring-white/5 group-hover:shadow-[0_0_20px_rgba(255,255,255,0.1)] transition-shadow duration-500 isolate">
                  <img src={track.coverUrl} alt="" className={`img-cover transition-transform duration-700 group-hover:scale-105 ${isPending ? 'opacity-50 grayscale' : ''}`} />
                  
                  {isPending && (
                    <div className="absolute inset-0 flex items-center justify-center z-30">
                      <div className="bg-black/50 p-1.5 rounded-full backdrop-blur-sm border border-white/5 shadow-xl">
                         <svg className="w-5 h-5 text-red-500 drop-shadow-[0_0_8px_rgba(239,68,68,0.8)]" fill="currentColor" viewBox="0 0 24 24">
                            <path d="M12 2C9.243 2 7 4.243 7 7V10H6C4.897 10 4 10.897 4 12V20C4 21.103 4.897 22 6 22H18C19.103 22 20 21.103 20 20V12C20 10.897 19.103 10 18 10H17V7C17 4.243 14.757 2 12 2ZM12 17C10.896 17 10 16.104 10 15C10 13.896 10.896 13 12 13C13.104 13 14 13.896 14 15C14 16.104 13.104 17 12 17ZM15 10H9V7C9 5.346 10.346 4 12 4C13.654 4 15 5.346 15 7V10Z" />
                         </svg>
                      </div>
                    </div>
                  )}

                  {rank && !isPending && (
                    <div className={`absolute top-0 left-0 px-2 py-1 rounded-br-xl rounded-tl-xl text-[10px] font-bold z-20 backdrop-blur-md shadow-sm ${
                      rank === 1 ? 'bg-yellow-400 text-black' :
                      rank === 2 ? 'bg-zinc-300 text-black' :
                      rank === 3 ? 'bg-[#CD7F32] text-white' : 'bg-zinc-800 text-white'
                    }`}>
                      #{rank}
                    </div>
                  )}

                  <div className={`absolute inset-0 flex items-center justify-center bg-black/40 backdrop-blur-[1px] transition-all duration-300 ${isActive ? 'opacity-100' : 'opacity-0 group-hover:opacity-100'}`}>
                    {isActive && isPlaying ? (
                      <svg className="w-6 h-6 text-white drop-shadow-md" fill="currentColor" viewBox="0 0 24 24"><path d="M6 19h4V5H6v14zm8-14v14h4V5h-4z"/></svg>
                    ) : (
                      <svg className="w-6 h-6 text-white drop-shadow-md ml-0.5" fill="currentColor" viewBox="0 0 24 24"><path d="M8 5v14l11-7z"/></svg>
                    )}
                  </div>
                </div>
                
                <div className="overflow-hidden flex-1">
                  <div className="flex items-center gap-2">
                    <h3 className={`font-semibold truncate text-base leading-tight transition-colors ${isActive ? 'text-white' : 'text-zinc-200 group-hover:text-white'}`}>
                      {track.title}
                    </h3>
                    
                    {!isOwner && onToggleFollow && (
                      <button 
                        onClick={(e) => {
                          e.stopPropagation();
                          onToggleFollow(track.artist);
                        }}
                        className={`
                          ml-1 px-3 py-0.5 rounded-full text-[10px] font-bold uppercase tracking-wider transition-all border
                          ${isFollowing 
                            ? 'bg-white text-black border-white hover:bg-zinc-200' 
                            : 'bg-transparent text-white border-white/30 hover:border-white hover:bg-white/10'}
                        `}
                      >
                        {isFollowing ? 'Following' : 'Follow'}
                      </button>
                    )}
                  </div>

                  <div className="flex items-center gap-2 mt-1 flex-wrap">
                    <span className="text-xs text-zinc-500 font-medium group-hover:text-zinc-400 flex items-center gap-0.5">
                      {track.artist}
                    </span>

                    {track.genre && (
                      <>
                        <span className="text-zinc-700">‚Ä¢</span>
                        <span className="text-[10px] bg-white/5 px-2 py-0.5 rounded-md text-zinc-400 font-medium uppercase tracking-wide border border-white/5 group-hover:border-white/10 transition-colors">
                          {track.genre}
                        </span>
                      </>
                    )}
                  </div>
                </div>
              </div>
              
              <div className="flex items-center gap-4 ml-4 flex-shrink-0 relative z-10">
                <div className="flex flex-col items-end">
                   <span className="text-[9px] text-zinc-600 uppercase font-bold tracking-widest">Plays</span>
                   <span className="text-[10px] sm:text-xs font-mono text-zinc-400 font-medium group-hover:text-white transition-colors">{track.plays.toLocaleString()}</span>
                </div>
                
                {onDelete && (
                  <button 
                    onClick={(e) => { e.stopPropagation(); onDelete(track.id); }}
                    className="p-2 rounded-full text-zinc-500 hover:text-red-400 hover:bg-white/5 transition-all z-10"
                  >
                    <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" /></svg>
                  </button>
                )}
              </div>
            </div>
          );
        };

        // --- AudioPlayer.tsx ---
        const AudioPlayer = ({ 
          track, isPlaying, setIsPlaying, onEnded, onClose, onToggleLike, isLiked, onRecordPlay 
        }) => {
          const audioRef = useRef(null);
          const [progress, setProgress] = useState(0);
          const [currentTime, setCurrentTime] = useState(0);
          const [duration, setDuration] = useState(0);
          const [isExpanded, setIsExpanded] = useState(false);
          const [hasRecordedPlay, setHasRecordedPlay] = useState(false);

          const waveformBars = useMemo(() => Array.from({ length: 45 }, () => Math.floor(Math.random() * 40) + 10), []);

          useEffect(() => {
            if (audioRef.current) {
              if (isPlaying) {
                audioRef.current.play().catch(() => setIsPlaying(false));
              } else {
                audioRef.current.pause();
              }
            }
          }, [isPlaying, track, setIsPlaying]);

          useEffect(() => {
            setHasRecordedPlay(false);
          }, [track.id]);

          const handleTimeUpdate = () => {
            if (audioRef.current) {
              const cur = audioRef.current.currentTime;
              const dur = audioRef.current.duration;
              setCurrentTime(cur);
              if (dur) {
                setProgress((cur / dur) * 100);
                
                if (!hasRecordedPlay && onRecordPlay) {
                  const threshold = Math.min(30, dur * 0.8);
                  if (cur >= threshold) {
                    onRecordPlay();
                    setHasRecordedPlay(true);
                  }
                }
              }
            }
          };

          const handleLoadedMetadata = () => {
            if (audioRef.current) {
              setDuration(audioRef.current.duration);
            }
          };

          const seek = (e) => {
            if (audioRef.current) {
              const rect = e.currentTarget.getBoundingClientRect();
              const pct = (e.clientX - rect.left) / rect.width;
              audioRef.current.currentTime = pct * audioRef.current.duration;
            }
            e.stopPropagation();
          };

          const formatTime = (time) => {
            if (isNaN(time)) return "0:00";
            const minutes = Math.floor(time / 60);
            const seconds = Math.floor(time % 60);
            return `${minutes}:${seconds < 10 ? '0' + seconds : seconds}`;
          };

          const toggleExpand = () => {
            setIsExpanded(!isExpanded);
          };

          const togglePlay = (e) => {
            e.stopPropagation();
            setIsPlaying(!isPlaying);
          };

          const handleReaction = () => {
            if (!isLiked) {
              onToggleLike?.();
            }
          };

          if (isExpanded) {
            return (
              <div className="fixed inset-0 z-[500] bg-zinc-900 flex flex-col animate-in slide-in-from-bottom-full duration-500">
                <audio 
                  ref={audioRef} 
                  src={track.audioUrl} 
                  onTimeUpdate={handleTimeUpdate}
                  onLoadedMetadata={handleLoadedMetadata}
                  onEnded={onEnded}
                />

                <div className="absolute inset-0 z-0">
                  <img src={track.coverUrl} alt="" className="w-full h-full object-cover opacity-60" />
                  <div className="absolute inset-0 bg-gradient-to-t from-[#121212] via-transparent to-black/30" />
                  <div className="absolute inset-0 bg-gradient-to-b from-black/40 to-transparent h-32" />
                </div>

                <div className="relative z-10 flex items-start justify-between p-4 pt-12 md:pt-6 safe-area-top">
                  <div className="flex flex-col items-start gap-2">
                    <div className="bg-black px-3 py-1.5">
                      <span className="text-white font-bold text-sm tracking-wide">{track.title}</span>
                    </div>
                    <div className="bg-black/80 px-3 py-1.5 backdrop-blur-md flex items-center gap-1">
                      <span className="text-zinc-300 font-medium text-xs">{track.artist}</span>
                    </div>
                  </div>

                  <button 
                    onClick={toggleExpand}
                    className="p-2 rounded-full bg-white/10 backdrop-blur-md text-white hover:bg-white/20 transition-colors"
                  >
                    <svg className="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M19 9l-7 7-7-7" /></svg>
                  </button>
                </div>

                <div className="flex-1 relative z-10" onClick={togglePlay}>
                  {!isPlaying && (
                    <div className="absolute inset-0 flex items-center justify-center pointer-events-none animate-in fade-in zoom-in duration-200">
                      <div className="bg-black/40 backdrop-blur-sm p-6 rounded-full border border-white/10">
                        <svg className="w-12 h-12 text-white fill-white ml-1" viewBox="0 0 24 24"><path d="M8 5v14l11-7z"/></svg>
                      </div>
                    </div>
                  )}
                </div>

                <div className="relative z-20 w-full pb-8 bg-gradient-to-t from-[#050505] via-[#050505]/95 to-transparent pt-10">
                  <div className="px-4 mb-2">
                    <div 
                      className="h-16 flex items-end justify-between gap-[2px] cursor-pointer touch-none"
                      onClick={seek}
                    >
                      {waveformBars.map((height, i) => {
                        const barPercent = (i / waveformBars.length) * 100;
                        const isPlayed = barPercent <= progress;
                        return (
                          <div 
                            key={i}
                            className={`w-full rounded-full transition-colors duration-100 ${isPlayed ? 'bg-gradient-to-t from-zinc-500 to-zinc-700' : 'bg-white/30'}`}
                            style={{ height: `${height}%` }}
                          />
                        );
                      })}
                    </div>
                    
                    <div className="flex justify-between mt-2 px-1">
                       <span className="text-[10px] font-bold bg-black/50 px-1.5 py-0.5 rounded text-white">{formatTime(currentTime)}</span>
                       <span className="text-[10px] font-bold bg-black/50 px-1.5 py-0.5 rounded text-zinc-400">{formatTime(duration)}</span>
                    </div>
                  </div>

                  <div className="px-4 py-6 flex items-center justify-center gap-6">
                       <button onClick={handleReaction} className="w-12 h-12 rounded-full bg-white/5 hover:bg-white/10 backdrop-blur-md border border-white/5 text-2xl hover:scale-110 active:scale-95 transition-all flex items-center justify-center shadow-lg">üî•</button>
                       <button onClick={handleReaction} className="w-12 h-12 rounded-full bg-white/5 hover:bg-white/10 backdrop-blur-md border border-white/5 text-2xl hover:scale-110 active:scale-95 transition-all flex items-center justify-center shadow-lg">üëè</button>
                       <button onClick={handleReaction} className="w-12 h-12 rounded-full bg-white/5 hover:bg-white/10 backdrop-blur-md border border-white/5 text-2xl hover:scale-110 active:scale-95 transition-all flex items-center justify-center shadow-lg">ü•π</button>
                  </div>

                  <div className="px-6 pt-2 pb-2 flex items-center justify-between text-white">
                    <div className="flex items-center gap-6">
                       <button 
                         onClick={onToggleLike}
                         className="flex items-center gap-2 group transition-all active:scale-90"
                       >
                         <svg 
                           className={`w-7 h-7 transition-colors ${isLiked ? 'text-red-500 fill-red-500' : 'text-white group-hover:text-red-500'}`} 
                           fill={isLiked ? "currentColor" : "none"} 
                           stroke="currentColor" 
                           viewBox="0 0 24 24"
                         >
                           <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z" />
                         </svg>
                         <span className="text-sm font-bold">{track.likes || 0}</span>
                       </button>
                       
                       <button className="group">
                         <svg className="w-7 h-7 group-hover:text-green-400 transition-colors" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M8.684 13.342C8.886 12.938 9 12.482 9 12c0-.482-.114-.938-.316-1.342m0 2.684a3 3 0 110-2.684m0 2.684l6.632 3.316m-6.632-6l6.632-3.316m0 0a3 3 0 105.367-2.684 3 3 0 00-5.367 2.684zm0 9.316a3 3 0 105.368 2.684 3 3 0 00-5.368-2.684z" /></svg>
                       </button>
                    </div>

                    <div className="flex items-center gap-6">
                      <button>
                        <svg className="w-7 h-7 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M4 6h16M4 12h16m-7 6h7" /></svg>
                      </button>
                      <button>
                        <svg className="w-7 h-7 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M12 5v.01M12 12v.01M12 19v.01M12 6a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2z" /></svg>
                      </button>
                    </div>
                  </div>
                </div>
              </div>
            );
          }

          return (
            <div 
              onClick={toggleExpand}
              className="relative w-full glass-dark rounded-[32px] p-4 md:p-5 shadow-[0_20px_60px_rgba(0,0,0,0.6)] animate-in slide-in-from-bottom-10 duration-500 border-t border-white/10 backdrop-blur-3xl group cursor-pointer hover:bg-white/5 transition-colors"
            >
              <audio 
                ref={audioRef} 
                src={track.audioUrl} 
                onTimeUpdate={handleTimeUpdate}
                onLoadedMetadata={handleLoadedMetadata}
                onEnded={onEnded}
              />
              
              <button 
                onClick={(e) => { e.stopPropagation(); onClose(); }}
                className="absolute top-2 right-2 p-2 rounded-full text-zinc-500 hover:text-white hover:bg-white/10 transition-colors z-20"
              >
                <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2.5" d="M6 18L18 6M6 6l12 12" /></svg>
              </button>
              
              <div className="flex items-center gap-4 md:gap-5 pr-8">
                <div className="w-12 h-12 md:w-14 md:h-14 rounded-[16px] overflow-hidden flex-shrink-0 shadow-lg ring-1 ring-white/10 relative group-hover/img:scale-100">
                  <img src={track.coverUrl} alt="" className="img-cover transition-transform duration-700" />
                </div>
                
                <div className="flex-1 min-w-0">
                  <h4 className="font-bold text-sm md:text-base syne tracking-tight truncate text-white">{track.title}</h4>
                  <p className="text-[10px] md:text-xs text-zinc-400 font-bold uppercase tracking-widest truncate mt-0.5 flex items-center gap-1">
                    {track.artist}
                  </p>
                </div>
                
                <button 
                  onClick={(e) => { e.stopPropagation(); setIsPlaying(!isPlaying); }}
                  className="w-10 h-10 md:w-12 md:h-12 flex items-center justify-center bg-white text-black rounded-full hover:scale-105 active:scale-95 transition-all shadow-[0_0_20px_rgba(255,255,255,0.3)] flex-shrink-0"
                >
                  {isPlaying ? (
                    <svg className="w-5 h-5 md:w-6 md:h-6" fill="currentColor" viewBox="0 0 24 24"><path d="M6 19h4V5H6v14zm8-14v14h4V5h-4z"/></svg>
                  ) : (
                    <svg className="w-5 h-5 md:w-6 md:h-6 pl-0.5" fill="currentColor" viewBox="0 0 24 24"><path d="M8 5v14l11-7z"/></svg>
                  )}
                </button>
              </div>
              
              <div className="mt-3 w-full">
                <div 
                  onClick={seek}
                  className="h-4 w-full cursor-pointer group/bar flex items-center"
                >
                  <div className="h-1.5 w-full bg-white/10 rounded-full overflow-hidden relative">
                    <div 
                      className="h-full bg-white transition-all duration-100 shadow-[0_0_15px_white] relative" 
                      style={{ width: `${progress}%` }}
                    >
                      <div className="absolute right-0 top-1/2 -translate-y-1/2 w-3 h-3 bg-white rounded-full opacity-0 group-hover/bar:opacity-100 transition-opacity shadow-[0_0_10px_white]" />
                    </div>
                  </div>
                </div>
                <div className="flex justify-between items-center px-0.5 -mt-1">
                  <span className="text-[10px] font-mono font-medium text-zinc-500">{formatTime(currentTime)}</span>
                  <span className="text-[10px] font-mono font-medium text-zinc-500">{formatTime(duration)}</span>
                </div>
              </div>
            </div>
          );
        };

        // --- BottomNav.tsx ---
        const BottomNav = ({ activeView, setView }) => {
          const items = [
            { id: View.HOME, icon: (
              <svg className="w-6 h-6 md:w-7 md:h-7" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2.5" d="M13 10V3L4 14h7v7l9-11h-7z" /></svg>
            )},
            { id: View.PLAYLISTS, icon: (
              <svg className="w-6 h-6 md:w-7 md:h-7" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2.5" d="M4 6h16M4 12h16m-7 6h7" /></svg>
            )},
            { id: View.PROFILE, icon: (
              <svg className="w-6 h-6 md:w-7 md:h-7" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2.5" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" /></svg>
            )},
            { id: View.SETTINGS, icon: (
              <svg className="w-6 h-6 md:w-7 md:h-7" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2.5" d="M12 6V4m0 2a2 2 0 100 4m0-4a2 2 0 110 4m-6 8a2 2 0 100-4m0 4a2 2 0 110-4m0 4v2m0-6V4" /></svg>
            )},
          ];

          return (
            <div className="relative rounded-full">
              <nav className="relative z-10 h-20 md:h-24 px-8 md:px-12 glass bg-[#050505]/60 rounded-full flex items-center gap-6 md:gap-10 shadow-[0_10px_40px_rgba(0,0,0,0.5)] border border-white/10 backdrop-blur-2xl transition-transform duration-300">
                {items.map(item => {
                  const isActive = activeView === item.id;
                  
                  return (
                    <button
                      key={item.id}
                      onClick={() => setView(item.id)}
                      className="group/btn relative w-12 h-12 md:w-14 md:h-14 flex items-center justify-center rounded-full outline-none"
                    >
                      {isActive && (
                        <div className="absolute inset-0 bg-white/5 rounded-full blur-md" />
                      )}

                      <div className={`relative z-20 transition-all duration-300 ${
                        isActive 
                          ? 'text-white scale-110 drop-shadow-[0_0_15px_rgba(255,255,255,0.6)]' 
                          : 'text-zinc-500 group-hover/btn:text-white'
                      }`}>
                        {item.icon}
                      </div>

                      {isActive && (
                         <div className="absolute -bottom-1.5 z-20 left-1/2 -translate-x-1/2 w-1 h-1 bg-white rounded-full shadow-[0_0_5px_white]" />
                      )}
                    </button>
                  );
                })}
              </nav>
            </div>
          );
        };

        // --- HomeView.tsx ---
        const HomeView = ({ 
          tracks, topTracks, onPlay, currentTrack, isPlaying, following, onToggleFollow, currentUser 
        }) => {
          const [searchQuery, setSearchQuery] = useState('');

          const publishedTracks = useMemo(() => {
            return tracks.filter(t => t.status !== 'pending');
          }, [tracks]);

          const filteredTracks = useMemo(() => {
            if (!searchQuery) return publishedTracks;
            return publishedTracks.filter(track => 
              track.artist.toLowerCase().includes(searchQuery.toLowerCase()) || 
              (track.featArtistName && track.featArtistName.toLowerCase().includes(searchQuery.toLowerCase()))
            );
          }, [publishedTracks, searchQuery]);

          return (
            <div className="space-y-10 animate-in fade-in slide-in-from-bottom-6 duration-700 w-full">
              
              <div className="relative group">
                <div className="absolute inset-y-0 left-0 pl-4 flex items-center pointer-events-none">
                  <svg className="w-5 h-5 text-zinc-500 group-focus-within:text-white transition-colors" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
                  </svg>
                </div>
                <input 
                  type="text"
                  value={searchQuery}
                  onChange={(e) => setSearchQuery(e.target.value)}
                  className="block w-full pl-12 pr-4 py-4 glass bg-white/5 rounded-2xl text-sm md:text-base text-white placeholder-zinc-500 focus:bg-white/10 focus:ring-1 focus:ring-white/20 transition-all outline-none"
                  placeholder="Find artist by nickname..."
                />
                {searchQuery && (
                  <button 
                    onClick={() => setSearchQuery('')}
                    className="absolute inset-y-0 right-0 pr-4 flex items-center cursor-pointer text-zinc-500 hover:text-white"
                  >
                    <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M6 18L18 6M6 6l12 12" /></svg>
                  </button>
                )}
              </div>

              {!searchQuery && (
                <section>
                  <div className="flex items-center justify-between mb-6">
                    <div className="flex items-center gap-3">
                      <h2 className="text-2xl font-bold heading-font tracking-tight text-white">Top of the Week</h2>
                    </div>
                  </div>
                  
                  {topTracks.length > 0 ? (
                    <div className="grid gap-3">
                      {topTracks.map((track, index) => (
                        <TrackItem 
                          key={track.id} 
                          track={track} 
                          onPlay={onPlay}
                          isActive={currentTrack?.id === track.id}
                          isPlaying={isPlaying}
                          isFollowing={following.includes(track.artist)}
                          onToggleFollow={onToggleFollow}
                          isOwner={track.artist === currentUser}
                          rank={index + 1}
                        />
                      ))}
                    </div>
                  ) : (
                    <div className="py-20 flex flex-col items-center justify-center glass rounded-3xl border-dashed border-2 border-zinc-800/50">
                      <p className="text-xs font-bold text-zinc-600 uppercase tracking-widest">No stats yet</p>
                    </div>
                  )}
                </section>
              )}

              <section>
                <div className="flex items-center justify-between mb-6">
                  <div className="flex items-center gap-3">
                    <h2 className="text-2xl font-bold heading-font tracking-tight text-white">
                      {searchQuery ? 'Search Results' : 'Discover'}
                    </h2>
                  </div>
                </div>

                {filteredTracks.length > 0 ? (
                  <div className="grid gap-3">
                    {filteredTracks.map(track => (
                      <TrackItem 
                        key={track.id} 
                        track={track} 
                        onPlay={onPlay}
                        isActive={currentTrack?.id === track.id}
                        isPlaying={isPlaying}
                        isFollowing={following.includes(track.artist)}
                        onToggleFollow={onToggleFollow}
                        isOwner={track.artist === currentUser}
                      />
                    ))}
                  </div>
                ) : (
                  <div className="py-32 flex flex-col items-center justify-center space-y-6 text-center">
                    <div className="w-24 h-24 rounded-full glass flex items-center justify-center text-zinc-700 shadow-xl">
                       <svg className="w-10 h-10" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="1.5" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" /></svg>
                    </div>
                    <div className="space-y-2">
                      <p className="text-xl font-semibold heading-font">
                        {searchQuery ? `No artists found for "${searchQuery}"` : "The feed is silent."}
                      </p>
                      <p className="text-sm text-zinc-500">
                        {searchQuery ? "Try checking the spelling." : "Upload your first track to get started."}
                      </p>
                    </div>
                  </div>
                )}
              </section>
            </div>
          );
        };

        // --- ProfileView.tsx ---
        const ProfileView = ({ 
          profile, setProfile, tracks, onUpload, onDelete, onPlay, currentTrack, isPlaying, userId, onAcceptInvite, onDeclineInvite
        }) => {
          const bannerInputRef = useRef(null);
          const avatarInputRef = useRef(null);
          const audioInputRef = useRef(null);
          const coverInputRef = useRef(null);

          const [activeTab, setActiveTab] = useState('releases');
          
          const [isUploading, setIsUploading] = useState(false);
          const [audioFile, setAudioFile] = useState(null);
          const [coverFile, setCoverFile] = useState(null);
          const [coverPreview, setCoverPreview] = useState(null);
          const [isSubmitting, setIsSubmitting] = useState(false);

          const [inviteSearch, setInviteSearch] = useState('');
          const [foundArtist, setFoundArtist] = useState(null);
          const [searchLoading, setSearchLoading] = useState(false);

          const [uploadMetadata, setUploadMetadata] = useState({
            title: '',
            description: '',
            genre: '',
            hashtags: '',
            featArtistId: '',
            featArtistName: ''
          });

          const myTracks = useMemo(() => {
            return tracks.filter(t => t.artist === profile.nickname);
          }, [tracks, profile.nickname]);

          const collabInvites = useMemo(() => {
            if (!userId) return [];
            return tracks.filter(t => t.featArtistId === userId && t.status === 'pending');
          }, [tracks, userId]);

          const checkArtist = async () => {
            if (!inviteSearch.trim()) return;
            setSearchLoading(true);
            setFoundArtist(null);
            try {
              const { data, error } = await supabaseClient
                .from('profiles')
                .select('user_id, nickname')
                .ilike('nickname', inviteSearch.trim())
                .single();

              if (data) {
                setFoundArtist({ id: data.user_id, nickname: data.nickname });
                setUploadMetadata(p => ({ ...p, featArtistId: data.user_id, featArtistName: data.nickname }));
              } else {
                alert('Artist not found');
                setUploadMetadata(p => ({ ...p, featArtistId: '', featArtistName: '' }));
              }
            } catch (e) {
              console.error(e);
              alert('Error searching artist');
            } finally {
              setSearchLoading(false);
            }
          };

          const clearArtistInvite = () => {
            setInviteSearch('');
            setFoundArtist(null);
            setUploadMetadata(p => ({ ...p, featArtistId: '', featArtistName: '' }));
          };

          const uploadImage = async (file, bucket) => {
            try {
              const fileName = `${Date.now()}-${file.name.replace(/[^a-zA-Z0-9.-]/g, '')}`;
              const { error: uploadError } = await supabaseClient.storage
                .from(bucket)
                .upload(fileName, file);

              if (uploadError) throw uploadError;

              const { data } = supabaseClient.storage.from(bucket).getPublicUrl(fileName);
              return data.publicUrl;
            } catch (error) {
              console.error(`Error uploading to ${bucket}:`, error);
              alert('Failed to upload image. Please try again.');
              return null;
            }
          };

          const handleAvatarSelect = async (e) => {
            const file = e.target.files?.[0];
            if (file) {
              const url = await uploadImage(file, 'avatars');
              if (url) {
                setProfile(prev => ({ ...prev, avatarUrl: url }));
              }
            }
          };

          const handleBannerSelect = async (e) => {
            const file = e.target.files?.[0];
            if (file) {
              const url = await uploadImage(file, 'banners');
              if (url) {
                setProfile(prev => ({ ...prev, bannerUrl: url }));
              }
            }
          };

          const handleAudioSelect = (e) => {
            const file = e.target.files?.[0];
            if (!file) return;
            setAudioFile(file);
            setUploadMetadata(prev => ({ ...prev, title: file.name.split('.')[0] }));
            setIsUploading(true);
          };

          const handleCoverSelect = (e) => {
            const file = e.target.files?.[0];
            if (file) {
              setCoverFile(file);
              setCoverPreview(URL.createObjectURL(file));
            }
          };

          const finalizeUpload = async () => {
            if (!audioFile) return;
            setIsSubmitting(true);
            
            try {
              await onUpload(uploadMetadata, audioFile, coverFile);
              setIsUploading(false);
              setAudioFile(null);
              setCoverFile(null);
              setCoverPreview(null);
              clearArtistInvite();
              setUploadMetadata({ title: '', description: '', genre: '', hashtags: '', featArtistId: '', featArtistName: '' });
            } catch (error) {
            } finally {
              setIsSubmitting(false);
            }
          };

          return (
            <div className="animate-in fade-in duration-700 w-full">
              <div className="relative mb-16">
                <div className="h-52 md:h-80 rounded-[32px] overflow-hidden glass relative group shadow-2xl">
                  <img src={profile.bannerUrl} alt="" className="img-cover opacity-90 group-hover:scale-105 transition-transform duration-1000" />
                  <div className="absolute inset-0 bg-gradient-to-t from-[#050505] via-transparent to-black/10"></div>
                  
                  <button 
                    onClick={() => bannerInputRef.current?.click()}
                    className="absolute top-4 right-4 p-2.5 glass rounded-full opacity-0 group-hover:opacity-100 transition-all hover:bg-white/20 active:scale-95"
                  >
                    <svg className="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z" /></svg>
                  </button>
                  <input type="file" ref={bannerInputRef} hidden accept="image/*" onChange={handleBannerSelect} />
                </div>

                <div className="-mt-20 md:-mt-24 relative z-10 flex flex-col md:flex-row items-center md:items-end gap-4 md:gap-8">
                  
                  <div className="relative w-32 h-32 md:w-44 md:h-44 flex-shrink-0 group">
                    <div className="w-full h-full rounded-[32px] border-[6px] border-[#050505] bg-[#1a1a1a] overflow-hidden shadow-[0_20px_40px_rgba(0,0,0,0.5)] relative">
                      <img src={profile.avatarUrl} alt="" className="img-cover" />
                      <div className="absolute inset-0 bg-black/30 opacity-0 group-hover:opacity-100 transition-opacity flex items-center justify-center backdrop-blur-[2px]">
                        <svg className="w-8 h-8 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M3 9a2 2 0 012-2h.93a2 2 0 001.664-.89l.812-1.22A2 2 0 0110.07 4h3.86a2 2 0 011.664.89l.812 1.22A2 2 0 0018.07 7H19a2 2 0 012 2v9a2 2 0 01-2 2H5a2 2 0 01-2-2V9z" /></svg>
                      </div>
                    </div>
                    <button 
                      onClick={() => avatarInputRef.current?.click()}
                      className="absolute inset-0 z-20 cursor-pointer opacity-0"
                    />
                    <input type="file" ref={avatarInputRef} hidden accept="image/*" onChange={handleAvatarSelect} />
                  </div>
                  
                  <div className="flex-1 min-w-0 space-y-3 text-center md:text-left w-full">
                    <div className="flex items-center justify-center md:justify-start gap-1.5 md:mb-1">
                      <h2 className="text-3xl md:text-6xl font-black heading-font tracking-tighter text-white drop-shadow-sm leading-none">
                        {profile.nickname}
                      </h2>
                    </div>
                    
                    <div className="flex items-center justify-center md:justify-start gap-6">
                      <div className="flex flex-col md:flex-row items-center md:items-baseline gap-1 md:gap-2">
                        <span className="text-lg md:text-xl font-bold text-white leading-none">{profile.followers}</span>
                        <span className="text-[10px] md:text-xs text-zinc-400 font-bold uppercase tracking-wider">Followers</span>
                      </div>
                      <div className="w-px h-4 bg-zinc-800"></div>
                      <div className="flex flex-col md:flex-row items-center md:items-baseline gap-1 md:gap-2">
                        <span className="text-lg md:text-xl font-bold text-white leading-none">{profile.following.length}</span>
                        <span className="text-[10px] md:text-xs text-zinc-400 font-bold uppercase tracking-wider">Following</span>
                      </div>
                    </div>

                    <div className="flex items-center justify-center md:justify-start gap-3 pt-1">
                      <span className="px-3 py-1 bg-white/5 border border-white/5 rounded-full text-[10px] font-bold text-zinc-300 uppercase tracking-wide backdrop-blur-md">
                        {myTracks.length} Tracks
                      </span>
                      <span className="text-[11px] font-medium text-zinc-500">Independent Artist</span>
                    </div>
                  </div>
                </div>
              </div>

              <div className="grid grid-cols-1 lg:grid-cols-[280px,1fr] gap-10 mt-12">
                
                <aside className="space-y-6">
                  <div className="glass p-6 rounded-[24px]">
                    <h4 className="text-xs font-bold text-zinc-500 uppercase tracking-widest mb-4">Bio</h4>
                    <p className="text-sm text-zinc-300 leading-relaxed font-medium opacity-90">{profile.bio || "No bio available."}</p>
                  </div>
                  
                  <button 
                    onClick={() => audioInputRef.current?.click()}
                    className="w-full py-4 bg-white text-black rounded-[20px] font-bold text-base shadow-[0_10px_20px_rgba(255,255,255,0.1)] hover:bg-zinc-200 active:scale-95 transition-all flex items-center justify-center gap-2 group"
                  >
                    <svg className="w-5 h-5 transition-transform group-hover:-translate-y-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2.5" d="M12 4v16m8-8H4" /></svg>
                    Upload Track
                  </button>
                  <input type="file" ref={audioInputRef} hidden accept="audio/*" onChange={handleAudioSelect} />
                  
                  {collabInvites.length > 0 && (
                     <div 
                       onClick={() => setActiveTab('invites')}
                       className="cursor-pointer bg-blue-500/10 border border-blue-500/30 p-4 rounded-2xl flex items-center gap-3 group"
                     >
                        <div className="w-8 h-8 rounded-full bg-blue-500 text-white flex items-center justify-center font-bold text-xs animate-pulse">
                          {collabInvites.length}
                        </div>
                        <div>
                          <h5 className="font-bold text-blue-200 text-sm">Pending Invites</h5>
                          <p className="text-[10px] text-blue-300/70">Tap to review requests</p>
                        </div>
                     </div>
                  )}
                </aside>

                <div className="space-y-5">
                  <div className="flex items-center justify-between border-b border-white/5 pb-4">
                     <div className="flex gap-6">
                       <button 
                         onClick={() => setActiveTab('releases')}
                         className={`text-xl font-bold heading-font transition-colors ${activeTab === 'releases' ? 'text-white' : 'text-zinc-500 hover:text-white'}`}
                       >
                         Latest Releases
                       </button>
                       {collabInvites.length > 0 && (
                         <button 
                           onClick={() => setActiveTab('invites')}
                           className={`text-xl font-bold heading-font transition-colors relative ${activeTab === 'invites' ? 'text-white' : 'text-zinc-500 hover:text-white'}`}
                         >
                           Inbox <span className="text-blue-500 text-sm align-top">‚óè</span>
                         </button>
                       )}
                     </div>
                  </div>
                  
                  <div className="flex flex-col gap-3">
                    {activeTab === 'releases' ? (
                      myTracks.length > 0 ? (
                        myTracks.map(track => (
                          <div key={track.id} className="relative group">
                            <TrackItem 
                              track={track} 
                              onPlay={onPlay} 
                              onDelete={onDelete}
                              isActive={currentTrack?.id === track.id}
                              isPlaying={isPlaying}
                              isOwner={true}
                              isPending={track.status === 'pending'}
                            />
                          </div>
                        ))
                      ) : (
                        <div className="py-24 text-center glass rounded-[32px] border-dashed border-2 border-zinc-800/50">
                          <p className="text-zinc-500 text-sm font-medium">No tracks uploaded yet</p>
                        </div>
                      )
                    ) : (
                      collabInvites.map(track => (
                         <div key={track.id} className="glass p-4 rounded-2xl flex flex-col md:flex-row items-center gap-4">
                            <div className="flex items-center gap-4 flex-1 w-full">
                               <img src={track.coverUrl} className="w-16 h-16 rounded-xl object-cover" alt="" />
                               <div>
                                 <h4 className="font-bold text-white">{track.title}</h4>
                                 <p className="text-xs text-zinc-400">Invited by <span className="text-white font-medium">{track.artist}</span></p>
                               </div>
                            </div>
                            <div className="flex items-center gap-2 w-full md:w-auto">
                              <button 
                                onClick={() => onDeclineInvite && onDeclineInvite(track)}
                                className="flex-1 md:flex-none px-4 py-2 bg-white/5 hover:bg-red-500/20 text-zinc-400 hover:text-red-200 rounded-lg text-xs font-bold transition-all"
                              >
                                Decline
                              </button>
                              <button 
                                onClick={() => onAcceptInvite && onAcceptInvite(track)}
                                className="flex-1 md:flex-none px-6 py-2 bg-white text-black rounded-lg text-xs font-bold hover:opacity-90 transition-opacity"
                              >
                                Accept Feature
                              </button>
                            </div>
                         </div>
                      ))
                    )}
                  </div>
                </div>
              </div>

              {isUploading && (
                <div className="fixed inset-0 z-[1000] flex items-end md:items-center justify-center p-0 md:p-6 bg-black/80 backdrop-blur-xl animate-in fade-in duration-300">
                  <div className="glass-dark w-full md:max-w-xl rounded-t-[32px] md:rounded-[32px] p-6 md:p-8 shadow-2xl border-white/5 space-y-6 overflow-y-auto max-h-[90vh] animate-in slide-in-from-bottom-20 duration-500">
                    <div className="flex justify-between items-center">
                      <h3 className="text-2xl font-bold heading-font">New Release</h3>
                      <button onClick={() => { setIsUploading(false); setAudioFile(null); clearArtistInvite(); }} className="p-2 bg-white/5 rounded-full hover:bg-white/10 transition-colors">
                        <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M6 18L18 6M6 6l12 12" /></svg>
                      </button>
                    </div>

                    <div className="flex flex-col md:flex-row gap-6">
                      <div 
                        onClick={() => coverInputRef.current?.click()}
                        className="w-full md:w-40 h-40 aspect-square rounded-2xl bg-zinc-900/50 border-2 border-dashed border-zinc-700 flex-shrink-0 cursor-pointer overflow-hidden flex items-center justify-center hover:border-white/30 transition-all group"
                      >
                        {coverPreview ? (
                          <img src={coverPreview} className="w-full h-full object-cover" />
                        ) : (
                          <div className="text-center group-hover:scale-105 transition-transform">
                            <span className="text-xs text-zinc-500 font-bold uppercase tracking-wide">Upload Art</span>
                          </div>
                        )}
                        <input type="file" ref={coverInputRef} hidden onChange={handleCoverSelect} />
                      </div>
                      
                      <div className="flex-1 space-y-4">
                        <div className="border-b border-zinc-800 pb-2">
                          <label className="text-xs font-bold text-zinc-500 uppercase tracking-wider">Title</label>
                          <input 
                            className="w-full text-lg font-bold bg-transparent pt-1"
                            placeholder="Track Name"
                            value={uploadMetadata.title}
                            onChange={e => setUploadMetadata(p => ({...p, title: e.target.value}))}
                          />
                        </div>
                        
                        <div className="border-b border-zinc-800 pb-2">
                          <label className="text-xs font-bold text-zinc-500 uppercase tracking-wider">Feat. Artist (Optional)</label>
                          {foundArtist ? (
                             <div className="flex items-center justify-between bg-white/5 p-2 rounded-lg mt-1">
                                <span className="text-sm font-bold text-white px-2">{foundArtist.nickname}</span>
                                <button onClick={clearArtistInvite} className="text-zinc-500 hover:text-white p-1">
                                  <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M6 18L18 6M6 6l12 12" /></svg>
                                </button>
                             </div>
                          ) : (
                            <div className="flex items-center mt-1 gap-2">
                              <input 
                                className="flex-1 text-base font-medium bg-transparent"
                                placeholder="Type artist nickname..."
                                value={inviteSearch}
                                onChange={e => setInviteSearch(e.target.value)}
                              />
                              {inviteSearch && (
                                <button 
                                  onClick={checkArtist}
                                  disabled={searchLoading}
                                  className="text-xs bg-white text-black px-3 py-1.5 rounded-full font-bold hover:opacity-90"
                                >
                                  {searchLoading ? '...' : 'Add'}
                                </button>
                              )}
                            </div>
                          )}
                        </div>

                        <div className="border-b border-zinc-800 pb-2">
                          <label className="text-xs font-bold text-zinc-500 uppercase tracking-wider">Genre</label>
                          <input 
                            className="w-full text-base font-medium bg-transparent pt-1"
                            placeholder="e.g. Lofi, Trap, House"
                            value={uploadMetadata.genre}
                            onChange={e => setUploadMetadata(p => ({...p, genre: e.target.value}))}
                          />
                        </div>
                      </div>
                    </div>

                    <div className="bg-zinc-900/50 rounded-2xl p-4 border border-white/5">
                      <label className="text-xs font-bold text-zinc-500 uppercase tracking-wider block mb-2">Description</label>
                      <textarea 
                        className="w-full h-24 text-sm text-zinc-300 resize-none bg-transparent"
                        placeholder="Tell listeners about your track..."
                        value={uploadMetadata.description}
                        onChange={e => setUploadMetadata(p => ({...p, description: e.target.value}))}
                      />
                    </div>

                    <button 
                      onClick={finalizeUpload}
                      disabled={isSubmitting}
                      className={`w-full py-4 bg-white text-black rounded-xl font-bold text-lg hover:opacity-90 active:scale-95 transition-all ${isSubmitting ? 'opacity-50 cursor-not-allowed' : ''}`}
                    >
                      {isSubmitting ? 'Uploading...' : (uploadMetadata.featArtistId ? 'Send Invite & Upload' : 'Publish')}
                    </button>
                  </div>
                </div>
              )}
            </div>
          );
        };

        // --- PlaylistsView.tsx ---
        const PlaylistsView = ({ playlists, tracks, setPlaylists, onPlay }) => {
          const [newPlaylistName, setNewPlaylistName] = useState('');

          const createPlaylist = () => {
            if (!newPlaylistName.trim()) return;
            const newPlaylist = {
              id: Math.random().toString(36).substr(2, 9),
              name: newPlaylistName,
              trackIds: []
            };
            setPlaylists(prev => [...prev, newPlaylist]);
            setNewPlaylistName('');
          };

          return (
            <div className="animate-in fade-in slide-in-from-bottom-2 duration-500 w-full">
              <div className="flex items-center justify-between mb-8">
                <h2 className="text-2xl font-bold heading-font tracking-tight text-white">Your Playlists</h2>
              </div>

              <div className="mb-8 flex gap-3">
                <input 
                  type="text" 
                  value={newPlaylistName}
                  onChange={(e) => setNewPlaylistName(e.target.value)}
                  placeholder="New playlist name..."
                  className="flex-1 glass border-none rounded-xl px-5 py-4 text-base focus:ring-1 focus:ring-white/20 transition-all outline-none"
                />
                <button 
                  onClick={createPlaylist}
                  className="px-6 py-4 bg-white text-black font-semibold rounded-xl hover:opacity-90 transition-opacity"
                >
                  Create
                </button>
              </div>

              <div className="grid gap-3">
                {playlists.length > 0 ? (
                  playlists.map(playlist => (
                    <div key={playlist.id} className="interactive-glass p-5 rounded-2xl group cursor-pointer hover:bg-white/5 transition-colors">
                      <div className="flex items-center justify-between relative z-10">
                        <div>
                          <h4 className="font-semibold text-lg text-white">{playlist.name}</h4>
                          <p className="text-xs text-zinc-500 uppercase tracking-widest mt-1 font-medium">{playlist.trackIds.length} tracks</p>
                        </div>
                        <div className="w-10 h-10 rounded-full bg-white/5 flex items-center justify-center group-hover:bg-white group-hover:text-black transition-colors">
                           <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M9 5l7 7-7 7" /></svg>
                        </div>
                      </div>
                    </div>
                  ))
                ) : (
                  <div className="py-24 text-center glass rounded-2xl border-dashed border-2 border-zinc-800/50">
                    <p className="text-zinc-500 text-sm font-medium">Create your first collection</p>
                  </div>
                )}
              </div>
            </div>
          );
        };

        // --- SettingsView.tsx ---
        const SettingsView = ({ profile, setProfile }) => {
          const [notificationsEnabled, setNotificationsEnabled] = useState(true);
          const [highQualityAudio, setHighQualityAudio] = useState(true);
          const [privateSession, setPrivateSession] = useState(false);
          const [nameError, setNameError] = useState(null);

          const handleNameChange = (e) => {
            const value = e.target.value;
            
            if (value.trim().toLowerCase() === 'conwes') {
              setNameError("This username is reserved for the official platform.");
              return;
            }

            setNameError(null);
            setProfile(prev => ({ ...prev, nickname: value }));
          };

          return (
            <div className="animate-in fade-in slide-in-from-bottom-2 duration-500 w-full space-y-8">
              <h2 className="text-2xl font-bold heading-font tracking-tight text-white mb-8">Settings</h2>

              <div className="space-y-4">
                <h3 className="text-xs font-bold text-zinc-500 uppercase tracking-widest pl-1">Profile Details</h3>
                <div className="glass p-6 rounded-[24px] space-y-6">
                  <div className="space-y-2">
                    <label className="text-xs text-zinc-400 font-medium ml-1">Display Name</label>
                    <input 
                      value={profile.nickname}
                      onChange={handleNameChange}
                      className={`w-full bg-white/5 border rounded-xl px-4 py-3 text-white focus:bg-white/10 transition-all placeholder:text-zinc-600 outline-none focus:ring-1 ${nameError ? 'border-red-500 focus:ring-red-500' : 'border-white/5 focus:ring-white/20'}`}
                      placeholder="Your Name"
                    />
                    {nameError && (
                      <p className="text-[10px] text-red-500 font-bold ml-1 animate-in slide-in-from-top-1">{nameError}</p>
                    )}
                  </div>
                  
                  <div className="space-y-2">
                    <label className="text-xs text-zinc-400 font-medium ml-1">Bio</label>
                    <textarea 
                      value={profile.bio}
                      onChange={(e) => setProfile(prev => ({ ...prev, bio: e.target.value }))}
                      className="w-full h-32 bg-white/5 border border-white/5 rounded-xl px-4 py-3 text-white focus:bg-white/10 transition-all resize-none placeholder:text-zinc-600 outline-none focus:ring-1 focus:ring-white/20 leading-relaxed"
                      placeholder="Tell us about yourself..."
                    />
                  </div>
                </div>
              </div>

              <div className="space-y-4">
                <h3 className="text-xs font-bold text-zinc-500 uppercase tracking-widest pl-1">Preferences</h3>
                <div className="glass rounded-[24px] overflow-hidden">
                  
                  <div 
                    onClick={() => setNotificationsEnabled(!notificationsEnabled)}
                    className="p-5 flex items-center justify-between border-b border-white/5 hover:bg-white/5 transition-colors cursor-pointer group"
                  >
                    <div>
                      <div className="text-white font-medium group-hover:text-white/90">Push Notifications</div>
                      <div className="text-xs text-zinc-500 mt-1">Receive updates about new releases and followers</div>
                    </div>
                    <div className={`w-12 h-7 rounded-full p-1 transition-colors duration-300 ${notificationsEnabled ? 'bg-white' : 'bg-white/10'}`}>
                      <div className={`w-5 h-5 rounded-full bg-black shadow-sm transition-transform duration-300 ${notificationsEnabled ? 'translate-x-5' : 'translate-x-0'}`} />
                    </div>
                  </div>

                  <div 
                    onClick={() => setHighQualityAudio(!highQualityAudio)}
                    className="p-5 flex items-center justify-between border-b border-white/5 hover:bg-white/5 transition-colors cursor-pointer group"
                  >
                    <div>
                      <div className="text-white font-medium group-hover:text-white/90">High Fidelity Audio</div>
                      <div className="text-xs text-zinc-500 mt-1">Stream in lossless quality when available (uses more data)</div>
                    </div>
                    <div className={`w-12 h-7 rounded-full p-1 transition-colors duration-300 ${highQualityAudio ? 'bg-white' : 'bg-white/10'}`}>
                      <div className={`w-5 h-5 rounded-full bg-black shadow-sm transition-transform duration-300 ${highQualityAudio ? 'translate-x-5' : 'translate-x-0'}`} />
                    </div>
                  </div>

                  <div 
                    onClick={() => setPrivateSession(!privateSession)}
                    className="p-5 flex items-center justify-between hover:bg-white/5 transition-colors cursor-pointer group"
                  >
                    <div>
                      <div className="text-white font-medium group-hover:text-white/90">Private Session</div>
                      <div className="text-xs text-zinc-500 mt-1">Hide your listening activity from followers temporarily</div>
                    </div>
                    <div className={`w-12 h-7 rounded-full p-1 transition-colors duration-300 ${privateSession ? 'bg-white' : 'bg-white/10'}`}>
                      <div className={`w-5 h-5 rounded-full bg-black shadow-sm transition-transform duration-300 ${privateSession ? 'translate-x-5' : 'translate-x-0'}`} />
                    </div>
                  </div>

                </div>
              </div>

              <div className="pt-8 pb-4 text-center space-y-2">
                <h4 className="font-bold text-lg heading-font text-white/20">conwes</h4>
                <p className="text-[10px] text-zinc-600 font-mono uppercase tracking-widest">Version 1.0.3 Beta</p>
              </div>
            </div>
          );
        };

        // --- App.tsx ---
        const App = () => {
          const [currentView, setCurrentView] = useState(View.HOME);
          const [tracks, setTracks] = useState([]);
          const [playlists, setPlaylists] = useState([]);
          const [likedTrackIds, setLikedTrackIds] = useState(new Set());
          
          const [userId] = useState(() => {
            const saved = localStorage.getItem('conwes_user_id');
            if (saved) return saved;
            const newId = crypto.randomUUID();
            localStorage.setItem('conwes_user_id', newId);
            return newId;
          });

          const [profile, setProfile] = useState({
            nickname: 'Guest User',
            avatarUrl: 'https://cdn.pixabay.com/photo/2015/10/05/22/37/blank-profile-picture-973460_1280.png',
            bannerUrl: 'https://images.unsplash.com/photo-1620641788421-7a1c342ea42e?w=1200&h=400&fit=crop&q=80',
            bio: 'Tap to edit your profile bio.',
            followers: 0,
            following: []
          });
          
          const [currentTrack, setCurrentTrack] = useState(null);
          const [isPlaying, setIsPlaying] = useState(false);
          
          const isInitialLoad = useRef(true);

          useEffect(() => {
            const handleContextMenu = (e) => {
              e.preventDefault();
            };
            document.addEventListener('contextmenu', handleContextMenu);
            return () => document.removeEventListener('contextmenu', handleContextMenu);
          }, []);

          const fetchData = useCallback(async () => {
            try {
              const { data: tracksData, error: tracksError } = await supabaseClient
                .from('tracks')
                .select('*')
                .order('created_at', { ascending: false });

              if (tracksData && !tracksError) {
                const mappedTracks = tracksData.map((t) => ({
                  id: t.id,
                  title: t.title,
                  artist: t.artist || 'Unknown',
                  audioUrl: t.audio_url,
                  coverUrl: t.cover_url,
                  description: t.description,
                  genre: t.genre,
                  plays: t.plays || 0,
                  likes: t.likes || 0,
                  commentsCount: t.comments_count || 0,
                  createdAt: new Date(t.created_at).getTime(),
                  status: t.status || 'published',
                  featArtistId: t.feat_artist_id,
                  featArtistName: t.feat_artist_name
                }));
                setTracks(mappedTracks);
              }

              const { data: profileData, error: profileError } = await supabaseClient
                .from('profiles')
                .select('*')
                .eq('user_id', userId)
                .single();

              if (profileData && !profileError) {
                setProfile({
                  nickname: profileData.nickname || 'Guest User',
                  avatarUrl: profileData.avatar_url || 'https://cdn.pixabay.com/photo/2015/10/05/22/37/blank-profile-picture-973460_1280.png',
                  bannerUrl: profileData.banner_url || 'https://images.unsplash.com/photo-1620641788421-7a1c342ea42e?w=1200&h=400&fit=crop&q=80',
                  bio: profileData.bio || 'Tap to edit your profile bio.',
                  followers: profileData.followers || 0,
                  following: profileData.following || []
                });
              } else if (!profileData) {
                const randomNum = Math.floor(Math.random() * 8001) + 1000;
                const defaultNickname = `con_${randomNum}`;

                const initialProfile = {
                  user_id: userId,
                  nickname: defaultNickname,
                  avatar_url: 'https://cdn.pixabay.com/photo/2015/10/05/22/37/blank-profile-picture-973460_1280.png',
                  banner_url: 'https://images.unsplash.com/photo-1620641788421-7a1c342ea42e?w=1200&h=400&fit=crop&q=80',
                  bio: 'Tap to edit your profile bio.',
                  followers: 0,
                  following: []
                };
                
                await supabaseClient.from('profiles').upsert(initialProfile);

                setProfile({
                  nickname: defaultNickname,
                  avatarUrl: initialProfile.avatar_url,
                  bannerUrl: initialProfile.banner_url,
                  bio: initialProfile.bio,
                  followers: 0,
                  following: []
                });
              }

            } catch (error) {
              console.error('Error fetching data:', error);
            } finally {
              isInitialLoad.current = false;
            }
          }, [userId]);

          useEffect(() => {
            fetchData();

            const savedPlaylists = localStorage.getItem('conwes_playlists_v3');
            const savedLikes = localStorage.getItem('conwes_liked_ids_v3');
            
            if (savedPlaylists) setPlaylists(JSON.parse(savedPlaylists));
            if (savedLikes) {
              try {
                setLikedTrackIds(new Set(JSON.parse(savedLikes)));
              } catch (e) { }
            }
          }, [fetchData]);

          useEffect(() => {
            if (isInitialLoad.current) return;

            const timer = setTimeout(async () => {
              const dbProfile = {
                user_id: userId,
                nickname: profile.nickname,
                bio: profile.bio,
                avatar_url: profile.avatarUrl,
                banner_url: profile.bannerUrl,
                followers: profile.followers,
                following: profile.following
              };
              
              const { error } = await supabaseClient.from('profiles').upsert(dbProfile);
              if (error) console.error('Error syncing profile:', error);
            }, 1000); 

            return () => clearTimeout(timer);
          }, [profile, userId]);

          useEffect(() => {
            localStorage.setItem('conwes_playlists_v3', JSON.stringify(playlists));
            localStorage.setItem('conwes_liked_ids_v3', JSON.stringify(Array.from(likedTrackIds)));
          }, [playlists, likedTrackIds]);

          const handlePlayTrack = useCallback(async (track) => {
            if (currentTrack?.id === track.id) {
              setIsPlaying(!isPlaying);
            } else {
              setCurrentTrack(track);
              setIsPlaying(true);
            }
          }, [currentTrack, isPlaying]);

          const handleRecordPlay = useCallback(async (trackId) => {
            setTracks(prev => prev.map(t => t.id === trackId ? { ...t, plays: t.plays + 1 } : t));

            const { error } = await supabaseClient.rpc('increment_plays', { track_id: trackId });
            if (error) {
              const track = tracks.find(t => t.id === trackId);
              if (track) {
                 await supabaseClient.from('tracks').update({ plays: track.plays + 1 }).eq('id', trackId);
              }
            }
          }, [tracks]);

          const handleTrackEnded = useCallback(() => {
            if (!currentTrack) return;
            
            const validTracks = tracks.filter(t => t.status !== 'pending');
            const currentIndex = validTracks.findIndex(t => t.id === currentTrack.id);
            
            if (currentIndex !== -1 && currentIndex < validTracks.length - 1) {
              const nextTrack = validTracks[currentIndex + 1];
              handlePlayTrack(nextTrack);
            } else {
              setIsPlaying(false);
            }
          }, [currentTrack, tracks, handlePlayTrack]);

          const handleClosePlayer = useCallback(() => {
            setIsPlaying(false);
            setCurrentTrack(null);
          }, []);

          const handleUpload = useCallback(async (metadata, audioFile, coverFile) => {
            try {
              const audioFileName = `${Date.now()}-${userId}-${audioFile.name.replace(/[^a-zA-Z0-9.-]/g, '')}`;
              const { data: audioData, error: audioError } = await supabaseClient.storage
                .from('audio')
                .upload(audioFileName, audioFile);

              if (audioError) throw new Error(`Audio upload failed: ${audioError.message}`);

              const { data: publicUrlData } = supabaseClient.storage.from('audio').getPublicUrl(audioFileName);
              const audioUrl = publicUrlData.publicUrl;

              let coverUrl = metadata.coverUrl || `https://picsum.photos/seed/${metadata.title}/1000`;
              if (coverFile) {
                const coverFileName = `${Date.now()}-${userId}-cover-${coverFile.name.replace(/[^a-zA-Z0-9.-]/g, '')}`;
                const { error: coverError } = await supabaseClient.storage
                  .from('covers')
                  .upload(coverFileName, coverFile);
                
                if (!coverError) {
                   const { data: coverUrlData } = supabaseClient.storage.from('covers').getPublicUrl(coverFileName);
                   coverUrl = coverUrlData.publicUrl;
                }
              }

              const status = metadata.featArtistId ? 'pending' : 'published';

              const fullTrackData = {
                title: metadata.title,
                artist: profile.nickname,
                audio_url: audioUrl,
                cover_url: coverUrl,
                description: metadata.description,
                genre: metadata.genre,
                hashtags: metadata.hashtags,
                plays: 0,
                likes: 0,
                status: status,
                feat_artist_id: metadata.featArtistId || null,
                feat_artist_name: metadata.featArtistName || null,
                created_at: new Date().toISOString()
              };

              let { data, error } = await supabaseClient.from('tracks').insert(fullTrackData).select().single();

              if (error && (error.message?.includes('column') || error.code === '42703')) {
                console.warn('New columns not found in DB, falling back to legacy track format.');
                const legacyTrackData = {
                    title: metadata.title,
                    artist: profile.nickname,
                    audio_url: audioUrl,
                    cover_url: coverUrl,
                    description: metadata.description,
                    genre: metadata.genre,
                    hashtags: metadata.hashtags,
                    plays: 0,
                    likes: 0,
                    created_at: new Date().toISOString()
                };
                const retry = await supabaseClient.from('tracks').insert(legacyTrackData).select().single();
                data = retry.data;
                error = retry.error;
                
                if (!error && status === 'pending') {
                     alert("Track uploaded! Note: Collaboration features are unavailable as the database schema hasn't been updated.");
                }
              }

              if (error) throw new Error(`Database insert failed: ${error.message}`);

              if (data) {
                const mappedTrack = {
                    id: data.id,
                    title: data.title,
                    artist: data.artist,
                    audioUrl: data.audio_url,
                    coverUrl: data.cover_url,
                    description: data.description,
                    genre: data.genre,
                    plays: 0,
                    likes: 0,
                    status: data.status,
                    featArtistId: data.feat_artist_id,
                    featArtistName: data.feat_artist_name,
                    createdAt: new Date(data.created_at).getTime()
                };
                setTracks(prev => [mappedTrack, ...prev]);
                if (status === 'pending' && !error) {
                  alert('Track uploaded! It will be visible once the invited artist accepts.');
                }
              } else {
                fetchData();
              }

            } catch (error) {
              console.error('Upload failed:', error);
              alert(`Upload failed: ${error.message || 'Unknown error. Check console for details.'}`);
            }
          }, [profile.nickname, userId, fetchData]);

          const handleDeleteTrack = useCallback(async (id) => {
            setTracks(prev => prev.filter(t => t.id !== id));
            if (currentTrack?.id === id) {
              setCurrentTrack(null);
              setIsPlaying(false);
            }
            await supabaseClient.from('tracks').delete().eq('id', id);
          }, [currentTrack]);

          const handleAcceptInvite = useCallback(async (track) => {
            setTracks(prev => prev.map(t => t.id === track.id ? { ...t, status: 'published' } : t));
            await supabaseClient.from('tracks').update({ status: 'published' }).eq('id', track.id);
          }, []);

          const handleDeclineInvite = useCallback(async (track) => {
            setTracks(prev => prev.filter(t => t.id !== track.id));
            await supabaseClient.from('tracks').delete().eq('id', track.id);
          }, []);


          const handleToggleFollow = useCallback((artistName) => {
            setProfile(prev => {
              const isFollowing = prev.following.includes(artistName);
              return {
                ...prev,
                following: isFollowing 
                  ? prev.following.filter(name => name !== artistName)
                  : [...prev.following, artistName]
              };
            });
          }, []);

          const handleToggleLike = useCallback(async (trackId) => {
            const isLiked = likedTrackIds.has(trackId);
            const newLikedIds = new Set(likedTrackIds);
            if (isLiked) {
              newLikedIds.delete(trackId);
            } else {
              newLikedIds.add(trackId);
            }
            setLikedTrackIds(newLikedIds);

            setTracks(prev => prev.map(t => {
              if (t.id === trackId) {
                const currentLikes = t.likes || 0;
                return { 
                  ...t, 
                  likes: isLiked ? Math.max(0, currentLikes - 1) : currentLikes + 1 
                };
              }
              return t;
            }));

            try {
              const track = tracks.find(t => t.id === trackId);
              if (track) {
                 const newCount = isLiked ? Math.max(0, track.likes - 1) : track.likes + 1;
                 await supabaseClient.from('tracks').update({ likes: newCount }).eq('id', trackId);
              }
            } catch (e) {
              console.error(e);
            }
          }, [likedTrackIds, tracks]);

          const topTracks = useMemo(() => {
            return [...tracks]
              .filter(t => t.plays > 0 && t.status !== 'pending')
              .sort((a, b) => b.plays - a.plays)
              .slice(0, 3);
          }, [tracks]);

          useEffect(() => {
            const handleMouseMove = (e) => {
              const shapes = document.querySelectorAll('.floating-shape');
              const mouseX = e.clientX / window.innerWidth;
              const mouseY = e.clientY / window.innerHeight;
              shapes.forEach((shape, index) => {
                const s = shape;
                const speed = (index + 1) * 5;
                const x = (mouseX - 0.5) * speed;
                const y = (mouseY - 0.5) * speed;
                s.style.transform = `translate(${x}px, ${y}px)`;
              });
            };
            window.addEventListener('mousemove', handleMouseMove);
            return () => window.removeEventListener('mousemove', handleMouseMove);
          }, []);

          const activeTrackData = useMemo(() => {
            if (!currentTrack) return null;
            return tracks.find(t => t.id === currentTrack.id) || currentTrack;
          }, [currentTrack, tracks]);

          return (
            <div className="min-h-screen bg-black text-zinc-100 font-sans selection:bg-white/20">
              <div className="parallax-bg">
                <div className="floating-shape w-[600px] h-[600px] top-[-10%] left-[-10%] bg-white/5" style={{transition: 'transform 0.4s ease-out'}}></div>
                <div className="floating-shape w-[400px] h-[400px] top-[40%] right-[-10%] bg-white/5" style={{transition: 'transform 0.6s ease-out'}}></div>
                <div className="floating-shape w-[300px] h-[300px] bottom-[-5%] left-[30%] bg-white/5" style={{transition: 'transform 0.8s ease-out'}}></div>
              </div>

              <header className="fixed top-0 left-0 right-0 h-20 flex items-center z-[100] bg-[#050505]/90 backdrop-blur-md border-b border-transparent hover:border-white/5 transition-all duration-500 group overflow-hidden">
                <div className="absolute top-0 left-[-100%] w-full h-full bg-gradient-to-r from-transparent via-white/5 to-transparent transition-all duration-1000 group-hover:left-[100%] pointer-events-none" />
                <div className="w-full max-w-4xl mx-auto px-6 md:px-8 flex items-center gap-4 relative z-10">
                  <Logo className="w-8 h-8 text-white" />
                  <h1 className="heading-font text-2xl font-bold tracking-tight text-white/90">
                    conwes
                  </h1>
                </div>
              </header>

              <main className="pt-28 pb-32 w-full max-w-4xl mx-auto px-6 md:px-8">
                {currentView === View.HOME && (
                  <HomeView 
                    tracks={tracks} 
                    topTracks={topTracks} 
                    onPlay={handlePlayTrack} 
                    currentTrack={activeTrackData}
                    isPlaying={isPlaying}
                    following={profile.following}
                    onToggleFollow={handleToggleFollow}
                    currentUser={profile.nickname}
                  />
                )}
                {currentView === View.PROFILE && (
                  <ProfileView 
                    profile={profile} 
                    setProfile={setProfile}
                    tracks={tracks} 
                    onUpload={handleUpload}
                    onDelete={handleDeleteTrack}
                    onPlay={handlePlayTrack}
                    currentTrack={activeTrackData}
                    isPlaying={isPlaying}
                    userId={userId} 
                    onAcceptInvite={handleAcceptInvite}
                    onDeclineInvite={handleDeclineInvite}
                  />
                )}
                {currentView === View.PLAYLISTS && (
                  <PlaylistsView 
                    playlists={playlists} 
                    tracks={tracks}
                    setPlaylists={setPlaylists}
                    onPlay={handlePlayTrack}
                  />
                )}
                {currentView === View.SETTINGS && (
                  <SettingsView 
                    profile={profile} 
                    setProfile={setProfile} 
                  />
                )}
              </main>

              <div className="fixed bottom-0 left-0 right-0 z-[200] pointer-events-none">
                <div className="w-full max-w-4xl mx-auto px-4 flex flex-col items-center pointer-events-auto">
                  {activeTrackData && (
                    <div className="w-full mb-6">
                      <AudioPlayer 
                        track={activeTrackData} 
                        isPlaying={isPlaying} 
                        setIsPlaying={setIsPlaying} 
                        onEnded={handleTrackEnded}
                        onClose={handleClosePlayer}
                        onToggleLike={() => handleToggleLike(activeTrackData.id)}
                        isLiked={likedTrackIds.has(activeTrackData.id)}
                        onRecordPlay={() => handleRecordPlay(activeTrackData.id)}
                      />
                    </div>
                  )}
                  <div className="mb-6">
                    <BottomNav activeView={currentView} setView={setCurrentView} />
                  </div>
                </div>
              </div>
            </div>
          );
        };

        // --- index.tsx logic ---
        const rootElement = document.getElementById('root');
        const root = ReactDOM.createRoot(rootElement);
        root.render(
          <React.StrictMode>
            <App />
          </React.StrictMode>
        );
    </script>
<script type="module" src="/index.tsx"></script>
</body>
</html>
